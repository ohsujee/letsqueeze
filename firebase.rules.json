{
  "rules": {
    "users": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
        ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
        "profile": {
          ".read": "auth != null",
          ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())"
        },
        "stats": {
          ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
          ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())"
        },
        "subscription": {
          ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
          ".write": false
        },
        "settings": {
          ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
          ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())"
        }
      }
    },
    "admins": {
      ".read": "root.child('admins').child(auth.uid).exists()",
      ".write": false
    },
    "rooms": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || ( !data.child('lockUid').exists() && newData.child('lockUid').val() == auth.uid && newData.child('buzz/uid').val() == auth.uid && root.child('rooms/'+$code+'/state/phase').val() == 'playing' ) )",
          "lockUid": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || ( !data.exists() && newData.val() == auth.uid && ( root.child('rooms/'+$code+'/state/canBuzz').val() == true || root.child('rooms/'+$code+'/state/buzzer/canBuzz').val() == true || root.child('rooms/'+$code+'/state/isBuzzArmed').val() == true || root.child('rooms/'+$code+'/state/can_buzz').val() == true || root.child('rooms/'+$code+'/state/buzzEnabled').val() == true || root.child('rooms/'+$code+'/state/armed').val() == true || root.child('rooms/'+$code+'/state/revealed').val() == true || root.child('rooms/'+$code+'/state/question/revealed').val() == true || root.child('rooms/'+$code+'/state/phase').val() == 'playing' ) ) )"
          },
          "buzzBanner": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || root.child('rooms/'+$code+'/state/lockUid').val() == auth.uid )"
          },
          "buzz": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || ( ( !root.child('rooms/'+$code+'/state/lockUid').exists() || root.child('rooms/'+$code+'/state/lockUid').val() == auth.uid ) && newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid ) )",
            ".validate": "newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid && (!newData.hasChild('anticipated') || newData.child('anticipated').isBoolean())"
          },
          "pausedAt": {
            ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
          },
          "lockedAt": {
            ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        },
        "history": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        },
        "__health__": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        },
        "flags": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        },
        "quiz": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        }
      }
    },
    "rooms_alibi": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()"
        },
        "teams": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()"
        },
        "score": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()"
        },
        "alibi": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()"
        },
        "questions": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()"
        },
        "interrogation": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val()",
          "responses": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid"
            }
          }
        },
        "answers": {
          ".read": "auth != null",
          "$visibleTo": {
            "$visibleFrom": {
              ".write": "auth != null && (auth.uid == $visibleFrom || auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val())",
              ".validate": "newData.isString() && newData.val().length <= 500"
            }
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms_alibi/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        }
      }
    },
    "rooms_blindtest": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && ( auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val() || ( !data.child('lockUid').exists() && newData.child('lockUid').val() == auth.uid && newData.child('buzz/uid').val() == auth.uid && root.child('rooms_blindtest/'+$code+'/state/phase').val() == 'playing' ) )",
          "lockUid": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val() || ( !data.exists() && newData.val() == auth.uid && root.child('rooms_blindtest/'+$code+'/state/phase').val() == 'playing' ) )"
          },
          "buzzBanner": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val() || root.child('rooms_blindtest/'+$code+'/state/lockUid').val() == auth.uid )"
          },
          "buzz": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val() || ( ( !root.child('rooms_blindtest/'+$code+'/state/lockUid').exists() || root.child('rooms_blindtest/'+$code+'/state/lockUid').val() == auth.uid ) && newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid ) )",
            ".validate": "newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid"
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        },
        "tracks": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val()"
        },
        "history": {
          ".write": "auth != null && auth.uid == root.child('rooms_blindtest/'+$code+'/meta/hostUid').val()"
        }
      }
    },
    "rooms_deeztest": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && ( auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val() || ( !data.child('lockUid').exists() && newData.child('lockUid').val() == auth.uid && newData.child('buzz/uid').val() == auth.uid && root.child('rooms_deeztest/'+$code+'/state/phase').val() == 'playing' ) )",
          "lockUid": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val() || ( !data.exists() && newData.val() == auth.uid && root.child('rooms_deeztest/'+$code+'/state/phase').val() == 'playing' ) )"
          },
          "buzzBanner": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val() || root.child('rooms_deeztest/'+$code+'/state/lockUid').val() == auth.uid )"
          },
          "buzz": {
            ".write": "auth != null && ( auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val() || ( ( !root.child('rooms_deeztest/'+$code+'/state/lockUid').exists() || root.child('rooms_deeztest/'+$code+'/state/lockUid').val() == auth.uid ) && newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid ) )",
            ".validate": "newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid"
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        },
        "tracks": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val()"
        },
        "history": {
          ".write": "auth != null && auth.uid == root.child('rooms_deeztest/'+$code+'/meta/hostUid').val()"
        }
      }
    },
    "rooms_trouveregle": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == root.child('rooms_trouveregle/'+$code+'/meta/hostUid').val()",
          "votes": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid"
            }
          },
          "guessVotes": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid"
            }
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms_trouveregle/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        }
      }
    }
  }
}
