{
  "rules": {
    ".read": "auth != null",
    "rooms": {
      "$code": {
        ".read": "auth != null",
        "meta": {
          ".write": "auth != null && ( !data.exists() ? newData.child('hostUid').val() == auth.uid : data.child('hostUid').val() == auth.uid )"
        },
        "state": {
          ".read": "auth != null",
          ".write": "auth != null && ( !root.child('rooms/'+$code+'/meta/hostUid').exists() || auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() )",
          "lockUid": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || ( !data.exists() && newData.val() == auth.uid && ( root.child('rooms/'+$code+'/state/canBuzz').val() == true || root.child('rooms/'+$code+'/state/buzzer/canBuzz').val() == true || root.child('rooms/'+$code+'/state/isBuzzArmed').val() == true || root.child('rooms/'+$code+'/state/can_buzz').val() == true || root.child('rooms/'+$code+'/state/buzzEnabled').val() == true || root.child('rooms/'+$code+'/state/armed').val() == true || root.child('rooms/'+$code+'/state/revealed').val() == true || root.child('rooms/'+$code+'/state/question/revealed').val() == true || root.child('rooms/'+$code+'/state/phase').val() == 'playing' ) ) )"
          },
          "buzzBanner": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || root.child('rooms/'+$code+'/state/lockUid').val() == auth.uid )"
          },
          "buzz": {
            ".write": "auth != null && ( auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() || ( ( !root.child('rooms/'+$code+'/state/lockUid').exists() || root.child('rooms/'+$code+'/state/lockUid').val() == auth.uid ) && newData.hasChildren(['uid','at']) && newData.child('uid').val() == auth.uid ) )",
            ".validate": "newData.hasChildren(['uid','at']) && (!newData.hasChild('anticipated') || newData.child('anticipated').isBoolean())"
          },
          "pausedAt": {
            ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
          },
          "lockedAt": {
            ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
          }
        },
        "players": {
          "$uid": {
            ".write": "auth != null && ( auth.uid == $uid || auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val() )"
          },
          ".read": "auth != null"
        },
        "history": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        },
        "__health__": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        },
        "flags": {
          ".write": "auth != null && auth.uid == root.child('rooms/'+$code+'/meta/hostUid').val()"
        }
      }
    }
  }
}
